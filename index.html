<html>
<link rel="stylesheet" type="text/css" href="css/textarea.css" />
<!-- canviz support start-->
<!-- <link rel="stylesheet" type="text/css" href="js/canviz-0.1/canviz.css" />-->
<script type="importmap">
{
  "imports": {
    "d3": "https://cdn.jsdelivr.net/npm/d3@7/+esm",
    "go": "./js/go-debug-module.js",
	"jquery": "https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"
 }
}
</script>
<script type="module" src="build/diagrammer_parser.js"></script>
<script type="module" src="web/index.js"></script>
<script type="module" src="web/visualizations/visualizations.js"></script>
<script type="module" src="web/visualizations/visualizeCirclePacked.js"></script>
<script type="module" src="web/visualizations/visualizeLayerBands.js"></script>
<script type="module" src="web/visualizations/visualizeParseTree.js"></script>
<script type="module" src="web/visualizations/visualizeRadialDendrogram.js"></script>
<script type="module" src="web/visualizations/visualizeReingoldTilford.js"></script>
<script type="module" src="web/visualizations/visualizeSankey.js"></script>
<script type="module" src="web/visualizations/visualizeUmlClass.js"></script>
<script type="module" src="web/uiComponentAccess.js"></script>
<script type="module" src="web/backendInteractions.js"></script>
<script type="module" src="web/localStorage.js"></script>
<script type="module" src="web/d3support.js"></script>
<!--<script type="text/javascript" src="js/mscgen.js"></script>-->

<!--[if lte IE 6]><link rel="stylesheet" type="text/css" href="js/canviz-0.1/canviz-ie6.css" /><![endif]-->
<!--[if IE]><script type="text/javascript" src="js/canviz-0.1/excanvas/excanvas.js"></script><![endif]-->
<!--<script type="text/javascript" src="js/canviz-0.1/prototype/prototype.js"></script>-->
<!--     <script src="//ajax.googleapis.com/ajax/libs/prototype/1.7.1.0/prototype.js"></script>
	<script type="text/javascript" src="js/canviz-0.1/path/path.js"></script>
	<script type="text/javascript" src="js/canviz-0.1/canviz.js"></script>
	<script type="text/javascript" src="js/canviz-0.1/x11colors.js"></script>
	<script type="text/javascript" src="js/canviz-0.1/graphs/graphlist.js"></script>
	<script type="text/javascript" src="js/canviz-0.1/graphs/layoutlist.js"></script>
-->
<!-- canviz support end-->

<!-- <script type="module" src="js/d3-sankey.js"></script> -->
<!-- Only way to get d3-sankey up and running, neither comply with importmapt or ES6 imports/exports -->
<script src="https://d3js.org/d3.v7.min.js"></script>
<script type="module" src="https://unpkg.com/d3-sankey@0"></script>

<body>
	<!-- top menu strip - horizontal -->
	<form name="contact" action="">
		<label for="generator">Generator</label>
		<select id="generator" name="generator" onChange="generatorChanged()">
 <option value="actdiag">Activity Diagram(cli)</option>
 <option value="ast">Abstract Syntax Tree</option>
 <option value="blckdiag">Block Diagram(cli)</option>
 <option value="dendrogram:circlepacked">Circle packed(TBD)</option>
 <option value="dendrogram:radialdendrogram">Radial Dendrogram</option>
 <option value="dendrogram:reingoldtilford">Reingold-Tilford</option>
 <option value="digraph:circo">Graphviz - circo(cli)</option>
 <option value="digraph:dot">Graphviz - dot(cli/www)</option>
 <option value="digraph:fdp">Graphviz - fdp(cli)</option>
 <option value="digraph:neato">Graphviz - neato(cli)</option>
 <option value="digraph:sfdp">Graphviz - sfdp(cli)</option>
 <option value="digraph:twopi">Graphviz - twopi(cli)</option>
 <option value="layerbands">LayerBands(GoJS)</option>
 <option value="mscgen">MSCGEN(cli)</option>
 <option value="nwdiag">Network Diagram(cli)</option>
 <option value="parsetree">ParseTree(GoJS)</option>
 <option value="plantuml_sequence">PlantUML - Sequence(cli)</option>
 <option value="sankey">Sankey</option>
 <option value="seqdiag">Sequence Diagram(cli)</option>
 <option value="umlclass">UMLClass(GoJS)</option>
			<!-- https://gojs.net/latest/samples/familytree.html -->
			<option value="familytree">FamilyTree(GoJS)</option>
			<!--  https://gojs.net/latest/samples/genogram.html -->
			<option value="genogram">Genogram(GoJS)</option>
			<!--  https://gojs.net/latest/samples/tLayout.html -->
			<option value="treelayout">TreeLayout(GoJS)</option>
			<!--  https://gojs.net/latest/samples/sequencediagram.html -->
			<option value="sequencediagram">SequenceDiagram(GoJS)</option>
		</select>
		<!-- handling examples -->
		<label for="example">Examples:</label>
		<select id="example" name="example" onChange="exampleChanged()">
			<!--ls tests/test_inputs/*txt|awk -F/ '{print "<option value=\""$2"\">"$2"</option>"}'-->
<option value="test_inputs/ast.txt">ast.txt</option>
<option value="test_inputs/compass.txt">compass.txt</option>
<option value="test_inputs/dendrogram.txt">dendrogram.txt</option>
<option value="test_inputs/dendrogram_spec.txt">dendrogram_spec.txt</option>
<option value="test_inputs/events.txt">events.txt</option>
<option value="test_inputs/fulltest.txt">fulltest.txt</option>
<option value="test_inputs/group_group_link.txt">group_group_link.txt</option>
<option value="test_inputs/layerbands.txt">layerbands.txt</option>
<option value="test_inputs/nodes.txt">nodes.txt</option>
<option value="test_inputs/parsetree.txt">parsetree.txt</option>
<option value="test_inputs/plantuml_context.txt">plantuml_context.txt</option>
<option value="test_inputs/plantuml_context2.txt">plantuml_context2.txt</option>
<option value="test_inputs/sankey.txt">sankey.txt</option>
<option value="test_inputs/seqdiag.txt">seqdiag.txt</option>
<option value="test_inputs/state.txt">state.txt</option>
<option value="test_inputs/state10.txt">state10.txt</option>
<option value="test_inputs/state11.txt">state11.txt</option>
<option value="test_inputs/state12.txt">state12.txt</option>
<option value="test_inputs/state13.txt">state13.txt</option>
<option value="test_inputs/state14.txt">state14.txt</option>
<option value="test_inputs/state15.txt">state15.txt</option>
<option value="test_inputs/state16.txt">state16.txt</option>
<option value="test_inputs/state2.txt">state2.txt</option>
<option value="test_inputs/state3.txt">state3.txt</option>
<option value="test_inputs/state4.txt">state4.txt</option>
<option value="test_inputs/state5.txt">state5.txt</option>
<option value="test_inputs/state6.txt">state6.txt</option>
<option value="test_inputs/state7.txt">state7.txt</option>
<option value="test_inputs/state8.txt">state8.txt</option>
<option value="test_inputs/state9.txt">state9.txt</option>
<option value="test_inputs/state_ancestry.txt">state_ancestry.txt</option>
<option value="test_inputs/state_android.txt">state_android.txt</option>
<option value="test_inputs/state_cluster_edge.txt">state_cluster_edge.txt</option>
<option value="test_inputs/state_conditionals.txt">state_conditionals.txt</option>
<option value="test_inputs/state_dual_node.txt">state_dual_node.txt</option>
<option value="test_inputs/state_group.txt">state_group.txt</option>
<option value="test_inputs/state_images.txt">state_images.txt</option>
<option value="test_inputs/state_innergroups.txt">state_innergroups.txt</option>
<option value="test_inputs/state_nodelinktests.txt">state_nodelinktests.txt</option>
<option value="test_inputs/state_recursive_linking.txt">state_recursive_linking.txt</option>
<option value="test_inputs/state_sequence.txt">state_sequence.txt</option>
<option value="test_inputs/state_sequence2.txt">state_sequence2.txt</option>
<option value="test_inputs/state_sip_sequence.txt">state_sip_sequence.txt</option>
<option value="test_inputs/state_tcp.txt">state_tcp.txt</option>
<option value="test_inputs/state_y_edge.txt">state_y_edge.txt</option>
<option value="test_inputs/umlclass.txt">umlclass.txt</option>
<option value="test_inputs/umlclass2.txt">umlclass2.txt</option>
<option value="test_inputs/url.txt">url.txt</option>
		</select>
		<label for="filename">Filename</label>
		<input type="text" id="filename" name="filename" value="output" />
		<button id="savefile"
			onclick="saveCurrentGraph(getCurrentFilename(), getGraphText());return false;">Save</button>
		<button id="loadfile" onclick="setGraphText(loadGraph(getCurrentFilename()));return false;">Load</button>
		<button id="import" onclick="importGraphs();return false;">Import</button>
		<button id="export" onclick="exportGraphs();return false;">Export</button>
		<!-- saved combobox and handlers -->
		<label for="saved">Saved graphs</label> <select id="saved" name="saved" onChange="savedChanged()"></select>
		<button onclick="visualize(getVisualizer());return false;">Visualize</button>
		<br />

		<div id="diagrammer-error"></div>
		<link rel="stylesheet" href="web/index.css">

		<!-- first horizontal toolbar icon strip -->
		<div class="htoolbar">
			<ul class="htoolbar">
				<li tooltip="actor" onclick="addLine('actor nodeName');"><img height="30" src="types/xactor.png" /></li>
				<li tooltip="beginpoint" onclick="addLine('beginpoint nodeName');"><img height="30"
						src="types/xbeginpoint.png" /></li>
				<li tooltip="box" onclick="addLine('box nodeName');"><img height="30" src="types/xbox.png" /></li>
				<li tooltip="circle" onclick="addLine('circle nodeName');"><img height="30" src="types/xcircle.png" />
				</li>
				<li tooltip="cloud" onclick="addLine('cloud nodeName');"><img height="30" src="types/xcloud.png" /></li>
				<li tooltip="condition" onclick="addLine('condition nodeName');"><img height="30"
						src="types/xcondition.png" /></li>
				<li tooltip="database" onclick="addLine('database nodeName');"><img height="30"
						src="types/xdatabase.png" /></li>
				<li tooltip="default" onclick="addLine('default nodeName');"><img height="30"
						src="types/xdefault.png" /></li>
				<li tooltip="diamond" onclick="addLine('diamond nodeName');"><img height="30"
						src="types/xdiamond.png" /></li>
				<li tooltip="dots" onclick="addLine('dots nodeName');"><img height="30" src="types/xdots.png" /></li>
				<li tooltip="doublecircle" onclick="addLine('doublecircle nodeName');"><img height="30"
						src="types/xdoublecircle.png" /></li>
				<li tooltip="ellipse" onclick="addLine('ellipse nodeName');"><img height="30"
						src="types/xellipse.png" /></li>
				<li tooltip="endpoint" onclick="addLine('endpoint nodeName');"><img height="30"
						src="types/xendpoint.png" /></li>
				<li tooltip="input" onclick="addLine('input nodeName');"><img height="30" src="types/xinput.png" /></li>
				<li tooltip="loop" onclick="addLine('loop nodeName');"><img height="30" src="types/xloop.png" /></li>
				<li tooltip="loopin" onclick="addLine('loopin nodeName');"><img height="30" src="types/xloopin.png" />
				</li>
			</ul>
		</div>

		<!-- second horizontal toolbar icon strip -->
		<div class="htoolbar">
			<ul class="htoolbar">
				<li tooltip="loopout" onclick="addLine('loopout nodeName');"><img height="30"
						src="types/xloopout.png" /></li>
				<li tooltip="mail" onclick="addLine('mail nodeName');"><img height="30" src="types/xmail.png" /></li>
				<li tooltip="minidiamond" onclick="addLine('minidiamond nodeName');"><img height="30"
						src="types/xminidiamond.png" /></li>
				<li tooltip="minisquare" onclick="addLine('minisquare nodeName');"><img height="30"
						src="types/xminisquare.png" /></li>
				<li tooltip="note" onclick="addLine('note nodeName');"><img height="30" src="types/xnote.png" /></li>
				<li tooltip="record" onclick="addLine('record nodeName');"><img height="30" src="types/xrecord.png" />
				</li>
				<li tooltip="rect" onclick="addLine('rect nodeName');"><img height="30" src="types/xrect.png" /></li>
				<li tooltip="roundedbox" onclick="addLine('roundedbox nodeName');"><img height="30"
						src="types/xroundedbox.png" /></li>
				<li tooltip="square" onclick="addLine('square nodeName');"><img height="30" src="types/xsquare.png" />
				</li>
				<li tooltip="terminator" onclick="addLine('terminator nodeName');"><img height="30"
						src="types/xterminator.png" /></li>
			</ul>
		</div>

		<!-- third horizontal toolbar icon strip -->
		<div class="htoolbar">
			<ul class="htoolbar">
				<li tooltip="normal_dir" onclick="addLine('a>b');"><img height="45" src="arrows/normal_dir.png" /></li>
				<li tooltip="dashed_dir" onclick="addLine('a->b');"><img height="45" src="arrows/dashed_dir.png" /></li>
				<li tooltip="dotted_dir" onclick="addLine('a.>b');"><img height="45" src="arrows/dotted_dir.png" /></li>
				<li tooltip="normal_both" onclick="addLine('a<>b');"><img height="45" src="arrows/normal_both.png" />
				</li>
				<li tooltip="dashed_both" onclick="addLine('a<->b');"><img height="45" src="arrows/dashed_both.png" />
				</li>
				<li tooltip="dotted_both" onclick="addLine('a<.>b');"><img height="45" src="arrows/dotted_both.png" />
				</li>
				<li tooltip="dashed_none" onclick="addLine('a-b');"><img height="45" src="arrows/dashed_none.png" />
				</li>
				<li tooltip="dotted_none" onclick="addLine('a.b');"><img height="45" src="arrows/dotted_none.png" />
				</li>
				<li tooltip="broken_l" onclick="addLine('a</b');"><img height="45" src="arrows/broken_l.png" /></li>
				<li tooltip="broker_r" onclick="addLine('a/>b');"><img height="45" src="arrows/broker_r.png" /></li>
				<li> <input type="button" value="Open Window" onclick="openPicWindow();"></li>
			</ul>
		</div>

		<table>
			<tr>
				<td>
					<!-- first leftmost vertical menu strip -->
					<div class="toolbar">
						<ul class="toolbar">
							<li onclick="addLine(1);">Colored vertex with label</li>
							<li onclick="addLine(2);">A Group</li>
							<li onclick="addLine(3);">Connected vertex pair</li>
							<li onclick="addLine(4);">Many connected vertices</li>
							<li onclick="addLine(5);">Start vertex</li>
							<li onclick="addLine(6);">Shape the reminder</li>
							<li onclick="addLine(7);">Add equals</li>
							<li onclick="addLine(8);">Variable color</li>
							<li onclick="addLine(9);">Conditional</li>
						</ul>
					</div>
				</td>
				<td>
					<!-- second middle vertical menu strip -->
					<div class="toolbar">
						<ul class="toolbar">
							<li onclick="addLine('NodeName/actor1.png');"><img height="30" src="icons/actor1.png" /></li>
							<li onclick="addLine('NodeName/actor2.png');"><img height="30" src="icons/actor2.png" /></li>
							<li onclick="addLine('NodeName/actor3.png');"><img height="30" src="icons/actor3.png" /></li>
							<li onclick="addLine('NodeName/barcode.png');"><img height="30" src="icons/barcode.png" /></li>
							<li onclick="addLine('NodeName/camera.png');"><img height="30" src="icons/camera.png" /></li>
							<li onclick="addLine('NodeName/harddisk.png');"><img height="30" src="icons/harddisk.png" /></li>
							<li onclick="addLine('NodeName/laser.png');"><img height="30" src="icons/laser.png" /></li>
							<li onclick="addLine('NodeName/phone.png');"><img height="30" src="icons/phone.png" /></li>
							<li onclick="addLine('NodeName/satellite.png');"><img height="30" src="icons/satellite.png" /></li>
							<li onclick="addLine('NodeName/usbmemory.png');"><img height="30" src="icons/usbmemory.png" /></li>
							<li onclick="addLine('NodeName/basestation.png');"><img height="30" src="icons/basestation.png" /></li>
							<li onclick="addLine('NodeName/cpu.png');"><img height="30" src="icons/cpu.png" /></li>
						</ul>
					</div>
				</td>
				<td>
					<!-- third rightmost vertical menu strip -->
					<div class="toolbar">
						<ul class="toolbar">
							<li onclick="addLine('NodeName/keyboard.png');"><img height="30" src="icons/keyboard.png" /></li>
							<li onclick="addLine('NodeName/monitor.png');"><img height="30" src="icons/monitor.png" /></li>
							<li onclick="addLine('NodeName/printer.png');"><img height="30" src="icons/printer.png" /></li>
							<li onclick="addLine('NodeName/scanner.png');"><img height="30" src="icons/scanner.png" /></li>
							<li onclick="addLine('NodeName/wifi.png');"><img height="30" src="icons/wifi.png" /></li>
							<li onclick="addLine('NodeName/battery.png');"><img height="30" src="icons/battery.png" /></li>
							<li onclick="addLine('NodeName/documents.png');"><img height="30" src="icons/documents.png" /></li>
							<li onclick="addLine('NodeName/laptop.png');"><img height="30" src="icons/laptop.png" /></li>
							<li onclick="addLine('NodeName/mouse.png');"><img height="30" src="icons/mouse.png" /></li>
							<li onclick="addLine('NodeName/ram.png');"><img height="30" src="icons/ram.png" /></li>
							<li onclick="addLine('NodeName/sim.png');"><img height="30" src="icons/sim.png" /></li>
							<li onclick="addLine('NodeName/timer.png');"><img height="30" src="icons/timer.png" /></li>
						</ul>
					</div>
				</td>
				<td>
					<!-- ACE editor + resulting graphs (server/dynamic)-->
					<table>
						<tr>
							<td class="tabbed">
									<input type="radio" id="tab1" name="css-tabs" checked>
									<input type="radio" id="tab2" name="css-tabs">
									
									<ul class="tabs">
										<li class="tab"><label for="tab1">Code</label></li>
										<li class="tab"><label for="tab2">Generated result</label></li>
									</ul>
									<div class="tab-content">
										<pre id="diagrammer-code" align="top" style="margin:0;left:0;height:600px;float:left"></pre>
									</div>
									<div class="tab-content">
										<textarea id="diagrammer-result" rows="40" cols="10"></textarea>
									</div>		
							</td>
							<td>
								<!-- result.png -->
								<div id='diagrammer-graph' />
							</td>
						</tr>
					</table>
				</td>
			</tr>
		</table>

		<!-- <svg id='chart' xmlns="http://www.w3.org/2000/svg"></svg> -->
		<!-- resulting data of grammar parser/ast generator -->
		<p>Javascript generated(dot only)</p>
		<div id="viz_container" style="border-width: 2px; border-style: dotted;" align="top"></div>

		<p>CanViZ</p>
		<div id="canviz_container"></div>
		<div id="diagrammer-debug"></div>
	</form>
</body>
<script src="js/viz.js"></script>
<script type="module" src="web/parserInteractions.js"></script>
<script type="module" src="web/editorInteractions.js"></script>
<script src="ace/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script type="module">
	const editor = ace.edit("diagrammer-code");
	//editor.setTheme("ace/theme/kr");
	editor.getSession().setMode("ace/mode/state");

	import { addLine, generatorChanged, exampleChanged, savedChanged, getGraphText, setGraphText } from "./web/editorInteractions.js";
	window.exampleChanged = exampleChanged;
	window.generatorChanged = generatorChanged;
	window.addLine = addLine;
	window.savedChanged = savedChanged;
	window.getVisualizer = getVisualizer;
	window.getGraphText = getGraphText;
	window.setGraphText = setGraphText;

	import { getCurrentFilename, openImage, openPicWindow, reloadImg, getVisualizer, getInputElement } from './web/uiComponentAccess.js';
	window.getCurrentFilename = getCurrentFilename;
	window.openImage = openImage;
	window.reloadImg = reloadImg;
	window.openPicWindow = openPicWindow;

	import { saveCurrentGraph, loadGraph, getSavedFilesAsOptionList} from "./web/localStorage.js";
	window.saveCurrentGraph = saveCurrentGraph;
	window.loadGraph = loadGraph;

	import { importGraphs, exportGraphs } from "./web/backendInteractions.js";
	window.importGraphs = importGraphs;
	window.exportGraphs = exportGraphs;

	import { visualize } from "./web/parserInteractions.js";
	window.visualize = visualize;

	const e = getInputElement('saved') // TODO: move up
	e.innerHTML = getSavedFilesAsOptionList()
	// select ast.txt example
	console.log('sel')
	document.querySelector('select#example>option[value="test_inputs/ast.txt"').selected=true
	exampleChanged()
</script>
<script type="text/javascript">
	//_MscParse("a>b");
	//  $.noConflict();
	//  jQuery(document).ready(function($) {
	//    // Code that uses jQuery's $ can follow here.
	//  });
	//  // Code that uses other library's $ can follow here.
</script>

</html>
