{"filename":"//Blaast TCP output\nbs;BlaastStack\nc;CWrapper\ns;SlirpInterface\nio;ip_output\nto;tcp_output\n\n","output":"//UDP Sending from PHONE to NETWORK depicted\n$(purple:#9977ff)\ngroup socket;Socket\n  sorecvfrom\ngroup end\n \ngroup Udp\n //INCOMING to TCP\n udp_output#00bfff \ngroup end\n\ngroup IPOutput\n  ip_output$(purple)\ngroup end \n\ngroup PhoneJava\n  udpFromB8#00ffee\ngroup end\n\ngroup IF\n  if_output$(purple) \n  if_start$(purple)\ngroup end \n\ngroup b8;Temporary B8 routing\n  handleIncomingNonFree#ffee00\ngroup end\n\nsorecvfrom>udp_output>ip_output>if_output>if_start>handleIncomingNonFree \nudpFromB8>ip_output","input":"bs;BlaastStack\nc;CWrapper\ns;SlirpInterface\nio;ip_onput\nto;tcp_output\n\n","tcp":"$(red:#ff0000)\n$(blue:#0000ff)\n$(yellow:#ffff00)\n \nshape box\nclosed$(red);CLOSED\nclosed_end$(red);closed\\nBack to start\nlisten$(yellow);LISTEN\nsyn_received$(grey:#888888);SYN\\nRECEIVED\nsyn_sent$(grey);SYN\\nSENT\nestablished#00ff00;ESTABLISHED\\ndata xchange occurs\n\ngroup PassiveClose$(lightblue:#afeeee);Passive CLOSE\n  close_wait$(yellow);CLOSE WAIT\n  last_ack$(yellow);LAST ACK\ngroup end\n\ngroup ActiveClose$(lightblue);Active CLOSE\n  fin_wait1$(yellow);FIN WAIT 1\n  closing$(yellow);CLOSING\n  fin_wait2$(yellow);FIN WAIT 2\n  time_wait$(yellow);TIME WAIT\ngroup end\n\n//unusual event\nsyn_sent.>closed;CLOSE/-\nsyn_sent.>syn_received;SYN/SYN+ACK\\n(simultaneous open)\nlisten.>syn_sent;SEND/SYN\nlisten.>closed;CLOSE/-\nsyn_received.>listen;RST/-\nsyn_received.>fin_wait1;CLOSE/FIN\nfin_wait1.>closing;FIN/ACK\nfin_wait1.>time_wait;FIN+ACK/ACK\nclosing.>time_wait\n\n// client / receiver path\nclosed>$(red)syn_sent;CONNECT/SYN(1/3 of 3w/hs)\nsyn_sent>$(red)established;SYN+ACK/ACK(3/3 of 3w/hs)\nestablished>$(red)fin_wait1;CLOSE/FIN\nfin_wait1>$(red)fin_wait2;ACK/-\nfin_wait2>$(red)time_wait;FIN/ACK\ntime_wait>$(red)closed_end;Timeout\n\n// server / sender path\nclosed>$(blue)listen;LISTEN/-\nlisten>$(blue)syn_received;SYN/SYN+ACK(2/3 of 3w/hs)\nsyn_received>$(blue)established;ACK/-\nestablished>$(blue)close_wait;FIN/ACK\nclose_wait>$(blue)last_ack;CLOSE/FIN\nlast_ack>$(blue)closed_end","slirp":"//UDP Sending from PHONE to NETWORK depicted\ngroup PhoneJava\n  senddata#7777ff;Send data\ngroup end\n\ngroup IPInput\n  ip_input$(purple:#9977ff)\n  senddata>ip_input\ngroup end \n\ngroup TcpInput\n  tcp_input$(purple)\n  shape diamond\n  foundtcp#77ff77\n  shape default\n  tcp_input>foundtcp>connect\ngroup end\n  \ngroup Icmp\n  icmp_input$(purple)\n  icmp_error$(purple)\ngroup end\n\ngroup Udp\n  udp_input$(purple)\n  findudp_so;Find UDP\n  shape diamond\n  foundudp#77ff77;Found\n  udp_emu#77ff77\n  shape default\n  udpseen;seen\n  udpnew;Create SO\n  sosendto\n  udp_input> findudp_so\n  findudp_so>foundudp\n  foundudp>udpnew,udpseen\n  udpseen,udpnew>udp_emu\n  udp_emu>sosendto\n  sosendto>icmp_error\ngroup end\n\ngroup b8;Temporary B8 routing\n b8udpwrap#779999\n b8tcpwrap#779999\n udp_input>b8udpwrap;IF b8 traffic\n tcp_input>b8tcpwrap;IF b8 traffic\ngroup end\n\nip_input>tcp_input,udp_input,icmp_input ","slirp_mainloop":"start main_loop\nip_slowtimo;ip_slowtimo\\nIP Timer process, free expired fragments\ntcp_fasttimo;tcp_fasttimo\\nProcess delayed ACKs\ntcp_slowtimo;tcp_slowtimo\\nper500ms\\nupdate timers\\nFSM actions\ndomainsockets;Read domain sockets\\ncall ip_input\nmain_loop>initSelect>select>tcp_fasttimo>tcp_output>ip_slowtimo\nip_slowtimo>tcp_slowtimo>domainsockets \ndomainsockets<>ip_input\n\ngroup checkSocketsGroup\nshape loopin\nscansockets\nshape default\nscansockets>sorecvoob>tcp_connect>soread>ctcp_output>tcp_input>sowrite\nshape loopout\ncheckSocketsDone\nshape default\nsowrite>checkSocketsDone \ngroup end\n\ndomainsockets>checkSocketsGroup \n\ncheckSocketsDone>receiveUdpPackets>main_loop\n","slirp_incoming_udp":"//UDP Sending from PHONE to NETWORK depicted\n$(purple:#9977ff)\ngroup socket;Socket\n  sorecvfrom\ngroup end\n \ngroup Udp\n //INCOMING to TCP\n udp_output#00bfff \ngroup end\n\ngroup IPOutput\n  ip_output$(purple)\ngroup end \n\ngroup PhoneJava\n  udpFromB8#00ffee\ngroup end\n\ngroup IF\n  if_output$(purple)\n  if_start$(purple)\ngroup end \n\ngroup b8;Temporary B8 routing\n  handleIncomingNonFree#ffee00\ngroup end\n\nsorecvfrom>udp_output>ip_output>if_output>if_start>handleIncomingNonFree \nudpFromB8>ip_output","sep-oct":"vertical\n$(master:#ef6060)\nbox AlarmHandlingCentral$(master)\nbox DataGeneration$(master)\nbox Alerts$(master)\nbox AlarmFramework$(master)\n\nAlarmHandlingCentral-(\n    AlarmFramework,\n    UIChanges,\n    Visualization\n)\n\nAlarmFramework-(\n    AutoDetectIorg,\n    AlertConfiguration,\n    AutogenAggrForCarrSpec\n)\nAlertConfiguration-(\n    Categorization,\n    AdditionalTags,\n    Title,\n    Inclusion,\n    CommonConfig,\n    AdditionalTags\n)\nUIChanges-(\n    SplitAlertConfigsToTabs\n)\nVisualization-(\n    PublishedDiffs,\n    ShowChanges\n)\n\nDataGeneration-(\n    SV_GK_MPP,\n    EventsToOpStream,\n    InternalTool\n)\n\nCommonConfig-(\n    DebugScubaLinks\n)\n(Fixing,Tuning)-Alerts-(New,Old)\nNew-(\n    SpikeInCarrierInterstitials,\n    DropHitsOnDialtoneTraffic,\n    FailingSpoofDetection,\n    FailingCarrierDetections,\n    MPPInsightUpdates\n)\n\nshape input\nnode color #ccddcc\nt8398284>DataGeneration\nt8398202>SplitAlertConfigsToTabs\nt8360134>AutogenAggrForCarrSpec\nt8360014>AdditionalTags\nt8398138>AutoDetectIorg\nt8360090>CommonConfig\nt8360204>DebugScubaLinks\nt8360005>UIChanges\nt7998019>SV_GK_MPP\nt8100701>InternalTool\nt7998000>Visualization\nt8100693>SV_GK_MPP\n\nt7783676>New\nt7783620>DropHitsOnDialtoneTraffic\nt7783574>SpikeInCarrierInterstitials\nt7783693>MPPInsightUpdates\nt7776079>FailingCarrierDetections\nt8360033>PublishedDiffs\n","sep-octwtasks":"vertical\n$(master:#ef6060)\nbox AlarmHandlingCentral$(master)\nbox DataGeneration$(master)\nbox Alerts$(master)\nbox AlarmFramework$(master)\n\nshape input\nnode color #ccddcc\nAutogenAggrForCarrSpec;AutogenAggrForCarrSpec\\nt8360134\nAutoDetectIorg;AutoDetectIorg\\nt8398138\nCommonConfig;CommonConfig\\nt8360090\nDebugScubaLinks;DebugScubaLinks\\nt8360204\nUIChanges;UIChanges\\nt8360005\nDropHitsOnDialtoneTraffic;DropHitsOnDialtoneTraffic\\nt7783620\nMPPInsightUpdates;MPPInsightUpdates\\nt7783693\nPerProxyTypeHeaders;PerProxyTypeHeaders\\nt??????\nDropInMobileImpressionsPerBrowser;DropInMobileImpressionsPerBrowser\\nt7783676\nVisualization;Visualization\\nt7998000\nnode color #66dd66\nSpikeInCarrierInterstitials;SpikeInCarrierInterstitials\\nt7783574\nFailingCarrierDetections;FailingCarrierDetections\\nt7776079\nPublishedDiffs;PublishedDiffs\\nt8360033\nEventsToOpStream;EventsToOpStream\\nt8398284\nAdditionalTags;AdditionalTags\\nt8360014\nMPPChangesOverODS;MPPChangesOverODS\\ntdone(D2432888)\nMPPChangesInfo;MPPChangesInfo\\ntdone(D2432888)\nAnomalyPredictorConfidenceIntervals;AnomalyPredictorConfidenceIntervals\\ndone\nSVChanges\nInternalToolChanges\nGKChanges\nODSOverlays\nContextualAlertInfo;ContextualAlertInfo\nSplitAlertConfigsToTabs;SplitAlertConfigsToTabs\\nt8398202\nSV_GK;SV_GK\\nt7998019\nInternalTool;InternalTool\\nt8100701\nOPStreamGroupHeaders;OPStreamGroupHeaders\\nt8100693\n\nshape ellipse\nnode color #ffffff\n\nAlarmHandlingCentral-\n    AlarmFramework,\n    UIChanges,\n    Visualization\n\nAlarmFramework-\n    AutoDetectIorg,\n    AlertConfiguration,\n    AutogenAggrForCarrSpec\n\nAlertConfiguration-\n    CommonConfig,\n    AdditionalTags,\n    HelpUIVisualization-(Title,Inclusion,Categorization)\n\nHelpUIVisualization-DebugScubaLinks\n\nUIChanges-\n    SplitAlertConfigsToTabs\n\nVisualization-\n    PublishedDiffs,\n    ContextualAlertInfo,\n    ODSOverlays\n\nDataGeneration-EventsToOpStream-\n    SV_GK,\n    OPStreamGroupHeaders,\n    InternalTool\n\nContextualAlertInfo-\n    MPPChangesInfo,\n    InternalToolChanges,\n    SVChanges,\n    GKChanges\n\nODSOverlays-\n    MPPChangesOverODS,\n    AnomalyPredictorConfidenceIntervals\n\nCommonConfig-\n    DebugScubaLinks\n\n(Fixing,Tuning)-Alerts-(New,Old)\nNew-\n    SpikeInCarrierInterstitials,\n    DropHitsOnDialtoneTraffic,\n    FailingSpoofDetection,\n    FailingCarrierDetections,\n    MPPInsightUpdates,\n    PerProxyTypeHeaders,\n    ZeroRateMonitoring,\n    SMSAlerts,\n    DropInMobileImpressionsPerBrowser\n\nOld-ConvertFromScubaToODS-\n    content_impressions,\n    fbs_pixel\n\nshape input\nnode color #ccddcc\n","headers_redirects":"genRedirectURI;MHeadersRedirectURIGenerator::genRedirectURI\ngenCanRedirect;MHeadersRedirectURIGenerator::genCanRedirect\ngenConvertURIToInsecureSubdomain;MHeadersURIGenerator::genConvertURIToInsecureSubdomain\ngenCanRequestInsecureSubdomain; MHeadersURIGenerator::genCanRequestInsecureSubdomain\ngetHeaderRequestCounter;MobileZeroCounter::getHeaderRequestCounter\ngenHeadersSubdomain;MHeadersURIGenerator::genHeadersSubdomain\n\ngenRedirectURI>\n    genCanRedirect>\n        genCanRequestInsecureSubdomain>\n            getHeaderRequestCounter>\n            genHeadersSubdomain>\n    genConvertURIToInsecureSubdomain\n        >genHeadersSubdomain\n        >getHeaderRequestCounter\n        \nMHomeController>genRedirectURI\nMIndexController>genRedirectLoginURI\n","optinflow":"generator plantuml_sequence\n$(redirect:#124567)\n$(action:#12ff00)\n$(auditing:#888888)\nu;User/\\nphone\nf;FB\nh;H-Site\na;Auditing\n\nu-u;Getting user consent =\\nlink to TOS is on shown=\\nimplicitly accepted\\nclicked or not\n\nu-u;M-Site new user registration\\nTOS shown on screen(or link)\nu.>$(action)u;Click create account\nu.u;prefilling\nu>f;m.fb.com/OPTIN=YES\na.>a;Optin detected::log ip,port\nf.>$(redirect)u;Redirect with token\\nh.fb.com/?app=99BLOB\na.>a;Sending NUX redirect::log ip,port,token\nu.>$(redirect)h;Get MSISDN\\nh.fb.com/?app=99BLOB\na.>a;NUX redirect exposure::log ip,port,token,msisdn\nh.>$(redirect)f;Return to flow\na.>a;Returning NUX form::log ip,port\nf>u;New account form\\nMSISDN prefilled\nu.>u;user fills form\nu>f;Create new account\na.>a;New account created::log ip,port\nf>u;Account created\n\nu-u;BSIA new user registration\\nTOS shown on screen(or link)\nu>u;May do prefill\\n(flow skipped)::Where could it\\nget the token?\nu>f;Create account\nf.>$(redirect)u;Redirect with token\\nh.fb.com/?app=99BLOB\nu.>$(redirect)h;Get MSISDN\\nh.fb.com/?app=99BLOB\nh.>$(redirect)f;Return to flow\nf>u;Created account\nu.u;done\n\nu-u;BSIW new user registration\\nTOS shown on screen(or link)\nu>f;Create account\nf.>$(redirect)u;Redirect with token\\nh.fb.com/?app=99BLOB\nu.>$(redirect)h;Get MSISDN\\nh.fb.com/?app=99BLOB\nh.>$(redirect)f;Return to flow\nf>u;Created account\nu.u;done\n\nu-u;New user registration\\nTOS shown on screen(or link)\nu>f;Create account\nf.>$(redirect)u;Redirect with token\\nh.fb.com/?app=99BLOB\nu.>$(redirect)h;Get MSISDN\\nh.fb.com/?app=99BLOB\nh.>$(redirect)f;Return to flow\nf>u;Created account\nu.u;done\n\nu-u;FB4A new user registration\\nTOS shown on screen(or link)\nu>u;May do prefill\\n(flow skipped)::Where could it\\nget the token?\nu>f;Create account\nf.>$(redirect)u;Redirect with token\\nh.fb.com/?app=99BLOB\nu.>$(redirect)h;Get MSISDN\\nh.fb.com/?app=99BLOB\nh.>$(redirect)f;Return to flow\nf>u;Created account\nu.u;done\n\nu-u;Existing FB User\\npiggy bag on campaign optin\nu.u;done\n","datainfra":"client/phone.png\ncarrier/satellite.png\n\n{edge;EDGE\n  eproxygen/keyboard.png\n  ecache/harddisk.png\n  eproxygen<>ecache\n}\n\n{fborigin;FB(origin) - SSL termination\n  oproxygen/keyboard.png\n  ocache/harddisk.png\n  oproxygen<>ocache\n}\n\ninvis log>(CDN,WWW,static,snaptu)\nfborigin>log\nclient<>carrier<>edge<>fborigin\n\nSHAPE RECORD\nscuba;Scuba | {time | carrier id | FBID | CDN type | pricing | Request bytes | response bytes | source(FB/FBS/MQTT/Snaptu/CDN/FB/FBS) | browser }\nhive;hive | {time |  carrier id? | FBID | CDN type | pricing | Request bytes | response bytes | source(FB/FBS/MQTT/Snaptu/CDN/FB/FBS) | browser | interface}\nVIPs;VIPs (tagged with pricing)\\nserves multiple domains| {30.1.25.7|30.1.25.8|30.1.25.9(free)|30.1.25.10|30.1.25.11|30.1.25.12(paid)}\nCartopragher;Cartographer\\nDNS| {EU|1.2.3.4|1.2.3.5}| {US|30.1.25.7|30.1.25.8}\n\np\ntailers\nhive2\nSHAPE diamond\nzero_slb\nzero_traffic_usage_hive\n\np>zero_slb>tailers>zero_traffic_usage_hive>hive2\n","operatraffic":"phone>\"free\"slot1\nphone>\"paid\"slot8\nslot1>\"carrier specific\\nrouting rules\"phone\nfb.>\"rules\"git.>\"\"slot8\n\nfb1;fb\nslot8>fb1\nslot1>fb1\nxx;Headers\\n-proxy-route\\n-proxy-oper\\n-XFF=carrier IP\n","zero_slb_pipeline":"diamond scribe;scribe\\nzero_traffic_usage_puma_sandbox\n\nshape note\nf;view_zero_traffic_usage_daily\\n(create view)\nc>f\n\nshape ellipse\ng;aggregated_for_sigma\\n(create table)\nh;aggregated_table_10m\\n(create table)\ni;aggregated_table_1d\\n(create table)\nj;aggregated_table_for_del2oid\\n(create table)\ne>g,h,i,j\nk;infinite_sigma\\n(create table)\nd>k\ndiamond k_s;si_inf_sigma_jobs\\n(scribe)\nk.>k_s\n\nh->a\ni->b\nj->c\ng->d\n\nl;metrics2/baldr_zero_traffic_usage_daily\\n(create table)\ndiamond l_s;baldr_zero_traffic_usage_daily\\n(scribe)\nl.>l_s\n\nm;metrics2/zero_traffic_usage\\n(create table)\ncloud m_s;rtdeltoid\\n(scuba)\nm.>m_s\nf>l,m\n\nn;zero_traffic_usage_10m\\n(create table)\ncloud n_s;zero_traffic_usage_10m\\n(scuba)\nn.>n_s\na>n\n\no;zero_traffic_usage_1d\\n(create table)\ncloud o_s;zero_traffic_usage_1d\\n(scuba)\no.>o_s\nb>o\n\nshape actor\na;aggregated_input_10m\\n(create input table)\nb;aggregated_input_1d\\n(create input table)\nc;aggregated_input_for_del2oid\\n(create input table)\nd;aggregated_input_for_sigma\\n(create input table)\n\ne;zero_traffic_usage_puma\\n(create input table)\nscribe>e\n\n","bitree":"a>#ff0000b>#ff0000c>b>a>#00ff00c>#ff0000a\n\nq;q33* (in=3,out=3)\nw;w33\ne;e33\nr;r33\n\nq>#ff0000\"Start traversing\\nto best connected node\\nand update\\ninput/output count\"w\nq>e\nq>r\n\nw>#00ff00q\nw>#ff0000e\nw>r\n\ne>q\ne>#00ff00w\ne>#ff0000r\n\nr>q\nr>w\nr>#00ff00e\n\n","mobileflow":"rt;rt=Request Type\ncid;cid=Carrier ID\nur;ur=Upstream Region\nrt.cid.ur\n\nphone/phone.png\nfnahit/harddisk.png\nfnamiss/harddisk.png\npop/laptop.png\ndc/monitor.png\n\nphone<>\"rt()\\ncid(1234)\\nur()\"fnahit\nphone<>\"rt(terminated)\\ncid(1234)\\nur()\"fnamiss\nphone<>\"rt(terminated)\\ncid(1234)\\nur()\"pop\nfnamiss<>\"rt(terminated)\\ncid(1234)\\nur()\"pop\npop<>\"rt(proxied)\\ncid(null)\\nur(frc)\"dc\n","newkeys":"{a;input parsing\ninput_has_datr>\"user id tests\"(userid_present,userid_invalid,userid_missing)\n}\nlines_processed;lines_processed++\\nactual amount of lines\\nwe processed\nlines_processed>a\n\n{q;query parsing\nnc_eui2_invalid_queryparam>\nnc_eui2_too_few_parts>\nnc_eui2_wrong_version\n}\na>has_cdn_content_id>nc_eui2_present>\"try parse\"q\n\n{d;decryption\nnc_eui2_has_valid_datr>\nnc_eui2_has_no_datr>\nnc_eui2_has_msisdn>\nnc_eui2_has_no_msisdn>\nnc_eui2_has_uid>\nnc_eui2_has_no_uid>\nnc_eui2_has_invalid_uid\n}\nq>\"parsed\"d\n{u;userid tests\ndatr_mismatch_from_nceui\nuserid_mismatch_from_nceui\n}\nd>u\n>nc_eui2_set_for_missing_uid\n\nnc_eui2_present.\"no nc_eui2\"nc_eui2_set_for_missing_uid\nq.\"parsing failed\"nc_eui2_set_for_missing_uid\nd.\"decryption failed\"nc_eui2_set_for_missing_uid"}
