digraph {
    compound=true;
    rankdir=TD;
    s[ fillcolor="#ff0000", shape="cds", style="filled" ];
    //startnode setup
    {rank = same;null} {rank = same; s}
        null [shape=plaintext, label=""];
        s[shape=doublecircle];
        null->s;

    s[ fillcolor="#ff0000", shape="cds", style="filled" ];
    c[ fillcolor="#0000ff", shape="cds", style="filled" ];
    subgraph cluster_1 {
        label="vpn connector";
        style=filled;
        color="#777777";
        m[ fillcolor="#0000ff", shape="box", style="filled" ];
        vb[ fillcolor="#0000ff", shape="box", style="filled" ];
        mo[ fillcolor="#0000ff", shape="box", style="filled" ];
        b[ fillcolor="#0000ff", shape="box", style="filled" ];
        v[ fillcolor="#0000ff", shape="box", style="filled" ];
    }//end of 1 undefined
    subgraph cluster_2 {
        label="Phone state listener";
        style=filled;
        color="#33ff33";
        e[ fillcolor="#0000ff", shape="box", style="filled" ];
    }//end of 2 undefined
    //links start
    s->c[ color="#00ff00", fontcolor="#ff00ff", label="connect,s=red\nlink=green\n this node=blue" ];
    c->m[ label="turn off mobile data" ];
    m->vb[ label="create blackhole VPN" ];
    vb->mo[ label="turn on mobile data" ];
    mo->b[ label="do bootstrap" ];
    b->v[ label="connect vpn" ];
    e->s[ label="wifi connected" ];
    e->s[ label="wifi disconnected" ];
    e->s[ label="mobile connected" ];
    e->s[ label="mobile disconnected" ];
}
